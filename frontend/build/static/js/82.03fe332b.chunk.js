"use strict";(self.webpackChunkstudy_in_moldova=self.webpackChunkstudy_in_moldova||[]).push([[82],{82:(e,t,a)=>{a.r(t),a.d(t,{default:()=>l});var s=a(43),n=a(375),r=a(213),d=a(768),c=a(579);const i=e=>{let{documents:t=[],documentTypes:a=[]}=e;return(0,c.jsx)("div",{className:"document-counter",children:(0,c.jsxs)("div",{className:"document-stats",children:[(0,c.jsxs)("div",{className:"document-stat",children:[(0,c.jsx)("span",{className:"stat-label",children:"Documente \xeenc\u0103rcate"}),(0,c.jsxs)("span",{className:"stat-value",children:[t.filter((e=>e&&"deleted"!==e.status)).length,"/",a.length]})]}),(0,c.jsxs)("div",{className:"document-stat",children:[(0,c.jsx)("span",{className:"stat-label",children:"\xcen a\u0219teptare"}),(0,c.jsx)("span",{className:"stat-value status-pending",children:t.filter((e=>e&&"pending"===e.status)).length})]}),(0,c.jsxs)("div",{className:"document-stat",children:[(0,c.jsx)("span",{className:"stat-label",children:"Aprobate"}),(0,c.jsx)("span",{className:"stat-value status-approved",children:t.filter((e=>e&&"approved"===e.status)).length})]}),(0,c.jsxs)("div",{className:"document-stat",children:[(0,c.jsx)("span",{className:"stat-label",children:"Respinse"}),(0,c.jsx)("span",{className:"stat-value status-rejected",children:t.filter((e=>e&&"rejected"===e.status)).length})]})]})})},o=[{id:"diploma",name:"Diploma",description:"Diploma de bacalaureat sau echivalent"},{id:"transcript",name:"Transcript",description:"Foaia matricol\u0103 cu notele"},{id:"passport",name:"Pa\u0219aport",description:"Pa\u0219aport valid"},{id:"photo",name:"Fotografie",description:"Fotografie recent\u0103 3x4"},{id:"medical",name:"Certificat Medical",description:"Certificat medical"},{id:"insurance",name:"Asigurare Medical\u0103",description:"Asigurare medical\u0103"},{id:"other",name:"Alte Documente",description:"Alte documente"},{id:"cv",name:"CV",description:"Curriculum Vitae"}],l=e=>{let{userData:t}=e;const[a,l]=(0,s.useState)([]),[u,m]=(0,s.useState)(!0),[p,h]=(0,s.useState)(null),[g,v]=(0,s.useState)({}),[f,j]=(0,s.useState)({}),[x,N]=(0,s.useState)(null);(0,s.useEffect)((()=>{y()}),[]),(0,s.useEffect)((()=>{(()=>{const e={};o.forEach((t=>{const s=a.find((e=>e&&e.document_type===t.id));s&&"deleted"!==s.status&&(e[t.id]={isDownloadActive:!0,isDeleteActive:"rejected"!==s.status})})),j(e),localStorage.setItem("documentButtonStates",JSON.stringify(e))})()}),[a]);const y=async()=>{try{m(!0),h(null);const e=await r.A.get(`${n.JR}/api/documents/user-documents`,{headers:(0,n.z5)()});if(!e.data)throw new Error("Nu s-au primit date de la server");let t=[];e.data.success&&e.data.data?t=Array.isArray(e.data.data)?e.data.data:[e.data.data]:Array.isArray(e.data)?t=e.data:e.data.documents&&Array.isArray(e.data.documents)&&(t=e.data.documents);const a=t.filter((e=>e&&"deleted"!==e.status)).map((e=>({id:e.id,document_type:e.document_type,name:e.name||e.document_type,status:e.status||"pending",url:e.url||e.file_path,uploadDate:e.uploadDate||e.createdAt,createdAt:e.createdAt})));l(a)}catch(p){console.error("Eroare la ob\u021binerea documentelor:",p),h((0,n.hS)(p))}finally{m(!1)}},w=e=>{const t=document.createElement("input");t.type="file",t.accept=".pdf,.jpg,.jpeg,.png",t.onchange=t=>{const a=t.target.files[0];if(a){if(a.size>10485760)return void d.oR.error("Fi\u0219ierul este prea mare. Dimensiunea maxim\u0103 permis\u0103 este de 10MB.");if(!["application/pdf","image/jpeg","image/jpg","image/png"].includes(a.type))return void d.oR.error("Tip de fi\u0219ier neacceptat. Sunt acceptate doar fi\u0219iere PDF, JPG, JPEG \u0219i PNG.");v((t=>({...t,[e]:{file:a,uploading:!1,uploaded:!1,progress:0}})))}},t.click()},A=async e=>{try{const t=await r.A.get(`${n.JR}/api/documents/${e}/download`,{headers:(0,n.z5)(),responseType:"blob"}),a=window.URL.createObjectURL(new Blob([t.data])),s=document.createElement("a");s.href=a,s.setAttribute("download","document.pdf"),document.body.appendChild(s),s.click(),s.remove()}catch(p){console.error("Eroare la desc\u0103rcarea documentului:",p),d.oR.error((0,n.hS)(p))}};return u?(0,c.jsx)("div",{className:"documents-section",children:(0,c.jsx)("div",{className:"loading",children:"Se \xeencarc\u0103 documentele..."})}):p?(0,c.jsx)("div",{className:"documents-section",children:(0,c.jsx)("div",{className:"error-message",children:p})}):(0,c.jsxs)("div",{className:"documents-section",children:[(0,c.jsx)("h2",{children:"Documentele Mele"}),(0,c.jsx)(i,{documents:a,documentTypes:o}),(0,c.jsx)("div",{className:"documents-grid",children:o.map((e=>{const t=(null===a||void 0===a?void 0:a.find((t=>(null===t||void 0===t?void 0:t.document_type)===e.id)))||null,s=g[e.id],i=t&&"deleted"!==t.status,o=(u=e.id,JSON.parse(localStorage.getItem("documentButtonStates")||"{}")[u]||{isDownloadActive:!1,isDeleteActive:!1});var u;return(0,c.jsxs)("div",{className:"document-item",children:[(0,c.jsxs)("div",{className:"document-info",children:[(0,c.jsx)("h3",{children:e.name}),(0,c.jsx)("p",{children:e.description}),i&&(0,c.jsxs)(c.Fragment,{children:[(0,c.jsxs)("p",{className:`status-${t.status}`,children:["Status: ","pending"===t.status?"\xcen procesare":"approved"===t.status?"Aprobat":"rejected"===t.status?"Respinse":"deleted"===t.status?"\u0218ters":t.status]}),(0,c.jsxs)("p",{children:["\xcenc\u0103rcat: ",new Date(t.uploadDate||t.createdAt).toLocaleDateString()]})]})]}),(0,c.jsx)("div",{className:"document-actions",children:i?(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)("button",{className:"download-button "+(o.isDownloadActive?"active":""),onClick:()=>A(t.id),children:"Descarc\u0103"}),(0,c.jsx)("button",{className:"delete-button "+(o.isDeleteActive?"active":""),onClick:()=>(async e=>{try{if(m(!0),h(null),!a.find((t=>t.id===e)))throw new Error("Documentul nu a fost g\u0103sit");const t=await r.A.delete(`${n.JR}/api/documents/${e}`,{headers:(0,n.z5)()});if(!t.data.success)throw new Error(t.data.message||"Eroare la \u0219tergerea documentului");{const t=a.filter((t=>t.id!==e));l(t),N("Document \u0219ters cu succes"),setTimeout((()=>N(null)),3e3)}}catch(p){console.error("Error deleting document:",p),p.response?404===p.response.status?h("Documentul nu a fost g\u0103sit"):403===p.response.status?h("Nu ave\u021bi permisiunea de a \u0219terge acest document"):h(p.response.data.message||"Eroare la \u0219tergerea documentului"):h(p.message||"Eroare la comunicarea cu serverul")}finally{m(!1)}})(t.id),children:"\u0218terge"})]}):(0,c.jsxs)(c.Fragment,{children:[(null===s||void 0===s?void 0:s.file)&&!(null!==s&&void 0!==s&&s.uploaded)&&(0,c.jsx)("button",{className:"upload-button",onClick:()=>(async e=>{try{var t;const s=null===(t=g[e])||void 0===t?void 0:t.file;if(!s)throw new Error("Nu a fost selectat niciun fi\u0219ier");v((t=>({...t,[e]:{...t[e],uploading:!0}})));const c=new FormData;c.append("file",s),c.append("document_type",e),c.append("status","pending");const i=await r.A.post(`${n.JR}/api/documents/upload`,c,{headers:{...(0,n.z5)(),"Content-Type":"multipart/form-data"},onUploadProgress:t=>{const a=Math.round(100*t.loaded/t.total);v((t=>({...t,[e]:{...t[e],progress:a}})))}});if(!i||!i.data)throw new Error("Nu s-a primit niciun r\u0103spuns de la server");if(!i.data.success)throw new Error(i.data.message||"Eroare la \xeenc\u0103rcarea documentului");{var a;const t={...i.data.data,status:(null===(a=i.data.data)||void 0===a?void 0:a.status)||"pending",document_type:e,uploadDate:new Date,createdAt:new Date};l((a=>[...a.filter((t=>t.document_type!==e)),t])),j((t=>({...t,[e]:{isDownloadActive:!0,isDeleteActive:!0}}))),await y(),d.oR.success("Document \xeenc\u0103rcat cu succes"),v((t=>({...t,[e]:{...t[e],uploaded:!0}})))}}catch(p){console.error("Eroare la \xeenc\u0103rcarea documentului:",p),d.oR.error(p.message||"A ap\u0103rut o eroare la \xeenc\u0103rcarea documentului")}finally{v((t=>({...t,[e]:{...t[e],uploading:!1}})))}})(e.id),disabled:s.uploading,children:s.uploading?"Se \xeencarc\u0103...":"\xcencarc\u0103"}),!(null!==s&&void 0!==s&&s.file)&&(0,c.jsx)("button",{className:"choose-button",onClick:()=>w(e.id),children:"Alege Fi\u0219ier"})]})}),(null===s||void 0===s?void 0:s.uploading)&&(0,c.jsxs)("div",{className:"upload-progress",children:[(0,c.jsx)("div",{className:"progress-bar",style:{width:`${s.progress}%`}}),(0,c.jsxs)("span",{children:[s.progress,"%"]})]})]},e.id)}))})]})}}}]);
//# sourceMappingURL=82.03fe332b.chunk.js.map