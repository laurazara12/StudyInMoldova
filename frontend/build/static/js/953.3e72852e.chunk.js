"use strict";(self.webpackChunkstudy_in_moldova=self.webpackChunkstudy_in_moldova||[]).push([[953],{953:(e,t,s)=>{s.r(t),s.d(t,{default:()=>l});var a=s(43),n=s(375),o=s(213),d=s(768),i=s(579);const c=e=>{let{documents:t=[],documentTypes:s=[]}=e;return(0,i.jsx)("div",{className:"document-counter",children:(0,i.jsxs)("div",{className:"document-stats",children:[(0,i.jsxs)("div",{className:"document-stat",children:[(0,i.jsx)("span",{className:"stat-label",children:"Uploaded Documents"}),(0,i.jsxs)("span",{className:"stat-value",children:[t.filter((e=>e&&"deleted"!==e.status)).length,"/",s.length]})]}),(0,i.jsxs)("div",{className:"document-stat",children:[(0,i.jsx)("span",{className:"stat-label",children:"Pending"}),(0,i.jsx)("span",{className:"stat-value status-pending",children:t.filter((e=>e&&"pending"===e.status)).length})]}),(0,i.jsxs)("div",{className:"document-stat",children:[(0,i.jsx)("span",{className:"stat-label",children:"Approved"}),(0,i.jsx)("span",{className:"stat-value status-approved",children:t.filter((e=>e&&"approved"===e.status)).length})]}),(0,i.jsxs)("div",{className:"document-stat",children:[(0,i.jsx)("span",{className:"stat-label",children:"Rejected"}),(0,i.jsx)("span",{className:"stat-value status-rejected",children:t.filter((e=>e&&"rejected"===e.status)).length})]})]})})},r=[{id:"diploma",name:"Diploma",description:"Bachelor's degree or equivalent"},{id:"transcript",name:"Transcript",description:"Grade transcript"},{id:"passport",name:"Passport",description:"Valid passport"},{id:"photo",name:"Photo",description:"Recent 3x4 photo"},{id:"medical",name:"Medical Certificate",description:"Medical certificate"},{id:"insurance",name:"Medical Insurance",description:"Medical insurance"},{id:"other",name:"Other Documents",description:"Other documents"},{id:"cv",name:"CV",description:"Curriculum Vitae"}],l=e=>{let{userData:t}=e;const[s,l]=(0,a.useState)([]),[u,p]=(0,a.useState)(!0),[m,h]=(0,a.useState)(null),[g,v]=(0,a.useState)({}),[f,j]=(0,a.useState)({}),[x,w]=(0,a.useState)(null),[N,y]=(0,a.useState)({pending:0,approved:0,rejected:0});(0,a.useEffect)((()=>{D()}),[]),(0,a.useEffect)((()=>{(()=>{const e={};r.forEach((t=>{const a=s.find((e=>e&&e.document_type===t.id));a&&"deleted"!==a.status&&(e[t.id]={isDownloadActive:!0,isDeleteActive:"rejected"!==a.status})})),j(e),localStorage.setItem("documentButtonStates",JSON.stringify(e))})()}),[s]);const D=async()=>{try{p(!0),h(null);const e=await o.A.get(`${n.JR}/api/documents/user-documents`,{headers:(0,n.z5)()});if(console.log("Server response documents:",e.data),!e.data)throw new Error("No data received from server");if(!e.data.success)throw new Error(e.data.message||"Error loading documents");const t=e.data.data||[];console.log(`Found ${t.length} documents`);const s=t.filter((e=>"deleted"!==e.status));console.log(`Found ${s.length} active documents out of ${t.length} total`);const a=s.map((e=>({id:e.id,document_type:e.document_type,status:e.status||"pending",filename:e.filename,originalName:e.originalName,createdAt:e.createdAt,uploadDate:e.uploadDate||e.createdAt,file_path:e.file_path})));if(console.log("Processed documents:",a),l(a),e.data.status)y(e.data.status);else{const e={pending:a.filter((e=>"pending"===e.status)).length,approved:a.filter((e=>"approved"===e.status)).length,rejected:a.filter((e=>"rejected"===e.status)).length};y(e)}}catch(m){console.error("Error loading documents:",m),h("Error loading documents: "+m.message),l([]),y({pending:0,approved:0,rejected:0})}finally{p(!1)}},b=e=>{const t=document.createElement("input");t.type="file",t.accept=".pdf,.jpg,.jpeg,.png,.doc,.docx,.xls,.xlsx",t.onchange=t=>{const s=t.target.files[0];if(s){if(s.size>10485760)return void d.oR.error("File is too large. Maximum allowed size is 10MB.");if(!["application/pdf","image/jpeg","image/jpg","image/png","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document","application/vnd.ms-excel","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"].includes(s.type))return void d.oR.error("Unsupported file type. Only PDF, JPG, JPEG, PNG, DOC, DOCX, XLS and XLSX files are accepted.");v((t=>({...t,[e]:{file:s,uploading:!1,uploaded:!1,progress:0}})))}},t.click()},A=async e=>{try{const t=s.find((t=>t.id===e)),a=(null===t||void 0===t?void 0:t.originalName)||"document",d=await o.A.get(`${n.JR}/api/documents/${e}`,{headers:(0,n.z5)(),responseType:"blob"}),i=window.URL.createObjectURL(d.data),c=document.createElement("a");c.href=i,c.setAttribute("download",a),document.body.appendChild(c),c.click(),c.remove(),window.URL.revokeObjectURL(i)}catch(m){console.error("Error downloading document:",m),d.oR.error((0,n.hS)(m))}};return u?(0,i.jsx)("div",{className:"documents-section",children:(0,i.jsx)("div",{className:"loading",children:"Loading documents..."})}):m?(0,i.jsx)("div",{className:"documents-section",children:(0,i.jsx)("div",{className:"error-message",children:m})}):(0,i.jsxs)("div",{className:"documents-section",children:[(0,i.jsx)("h2",{children:"My Documents"}),(0,i.jsx)(c,{documents:s,documentTypes:r}),(0,i.jsx)("div",{className:"documents-grid",children:r.map((e=>{const t=(null===s||void 0===s?void 0:s.find((t=>(null===t||void 0===t?void 0:t.document_type)===e.id)))||null,a=g[e.id],c=t&&"deleted"!==t.status,r=(u=e.id,JSON.parse(localStorage.getItem("documentButtonStates")||"{}")[u]||{isDownloadActive:!1,isDeleteActive:!1});var u;return(0,i.jsxs)("div",{className:"document-item",children:[(0,i.jsxs)("div",{className:"document-info",children:[(0,i.jsx)("h3",{children:e.name}),(0,i.jsx)("p",{children:e.description}),c&&(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)("p",{className:`status-${t.status}`,children:["Status: ","pending"===t.status?"Processing":"approved"===t.status?"Approved":"rejected"===t.status?"Rejected":"deleted"===t.status?"Deleted":t.status]}),(0,i.jsxs)("p",{children:["Uploaded: ",new Date(t.uploadDate||t.createdAt).toLocaleDateString()]})]})]}),(0,i.jsx)("div",{className:"document-actions",children:c?(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("button",{className:"download-button "+(r.isDownloadActive?"active":""),onClick:()=>A(t.id),children:"Download"}),(0,i.jsx)("button",{className:"delete-button "+(r.isDeleteActive?"active":""),onClick:()=>(async e=>{if(window.confirm("Are you sure you want to delete the document?"))try{p(!0),h(null);const t=await o.A.delete(`${n.JR}/api/documents/${e}`,{headers:(0,n.z5)()});if(!t.data.success)throw new Error(t.data.message||"Error deleting document");await D(),w("Document deleted successfully"),setTimeout((()=>w(null)),3e3)}catch(m){console.error("Error deleting document:",m),m.response?404===m.response.status?h("Document not found"):403===m.response.status?h("You do not have permission to delete this document"):h(m.response.data.message||"Error deleting document"):h(m.message||"Error communicating with server")}finally{p(!1)}})(t.id),children:"Delete"})]}):(0,i.jsxs)(i.Fragment,{children:[(null===a||void 0===a?void 0:a.file)&&!(null!==a&&void 0!==a&&a.uploaded)&&(0,i.jsx)("button",{className:"upload-button",onClick:()=>(async e=>{try{var t;const a=null===(t=g[e])||void 0===t?void 0:t.file;if(!a)throw new Error("No file selected");v((t=>({...t,[e]:{...t[e],uploading:!0}})));const i=new FormData;i.append("document_type",e),i.append("file",a),i.append("status","pending");const c=await o.A.post(`${n.JR}/api/documents/upload`,i,{headers:{...(0,n.z5)(),"Content-Type":"multipart/form-data"},onUploadProgress:t=>{const s=Math.round(100*t.loaded/t.total);v((t=>({...t,[e]:{...t[e],progress:s}})))}});if(!c||!c.data)throw new Error("No response received from server");if(!c.data.success)throw new Error(c.data.message||"Error uploading document");{var s;const t={...c.data.data,status:(null===(s=c.data.data)||void 0===s?void 0:s.status)||"pending",document_type:e,uploadDate:new Date,createdAt:new Date};l((s=>[...s.filter((t=>t.document_type!==e)),t])),j((t=>({...t,[e]:{isDownloadActive:!0,isDeleteActive:!0}}))),await D(),d.oR.success("Document uploaded successfully"),v((t=>({...t,[e]:{...t[e],uploaded:!0}})))}}catch(m){console.error("Error uploading document:",m),d.oR.error(m.message||"An error occurred while uploading the document")}finally{v((t=>({...t,[e]:{...t[e],uploading:!1}})))}})(e.id),disabled:a.uploading,children:a.uploading?"Uploading...":"Upload"}),!(null!==a&&void 0!==a&&a.file)&&(0,i.jsx)("button",{className:"choose-button",onClick:()=>b(e.id),children:"Choose File"})]})}),(null===a||void 0===a?void 0:a.uploading)&&(0,i.jsxs)("div",{className:"upload-progress",children:[(0,i.jsx)("div",{className:"progress-bar",style:{width:`${a.progress}%`}}),(0,i.jsxs)("span",{children:[a.progress,"%"]})]})]},e.id)}))})]})}}}]);
//# sourceMappingURL=953.3e72852e.chunk.js.map