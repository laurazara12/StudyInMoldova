"use strict";(self.webpackChunkstudy_in_moldova=self.webpackChunkstudy_in_moldova||[]).push([[779],{779:(e,a,t)=>{t.r(a),t.d(a,{default:()=>m});var s=t(43),r=t(213),i=t(677),n=t(393),o=t(375),c=t(579);const l="pk_test_51RSwngQong6azP1PUEIUaovsL9cTrVVPP3IKyXKzRNvyHY9RNeRJ9o76VHojiog3DUkQtTJDqSz1w1IU0s1U0nld006H4Fqufo",d=(0,i.c)(l),u=e=>{let{onPaymentSuccess:a,onPaymentError:t}=e;const r=(0,n.useStripe)(),i=(0,n.useElements)(),[o,l]=(0,s.useState)(!1),[d,u]=(0,s.useState)(null),[m,p]=(0,s.useState)(navigator.onLine),[h,g]=(0,s.useState)(null);(0,s.useEffect)((()=>{if(!r||!i)return;const e=()=>{p(!0),u(null)},a=()=>{p(!1),u("No internet connection. Please check your connection and try again.")};return window.addEventListener("online",e),window.addEventListener("offline",a),()=>{window.removeEventListener("online",e),window.removeEventListener("offline",a)}}),[r,i]);return(0,c.jsxs)("form",{onSubmit:async e=>{if(e.preventDefault(),m){if(l(!0),u(null),g(null),!r||!i)return u("Stripe is not initialized correctly. Please refresh the page."),void l(!1);try{const{error:e,paymentIntent:s}=await r.confirmPayment({elements:i,confirmParams:{return_url:`${window.location.origin}/payment-success`},redirect:"if_required"});e?(console.error("Stripe Error:",e),g(e.message),u("An error occurred while processing the payment. Please try again."),t(e.message)):s&&"succeeded"===s.status?a(s.id):(u("Payment could not be processed. Please try again."),t("Payment could not be processed."))}catch(s){console.error("Payment processing error:",s),navigator.onLine?u("An error occurred while processing the payment. Please check your internet connection and try again."):u("Internet connection was interrupted. Please check your connection and try again."),t("An error occurred while processing the payment.")}l(!1)}else u("No internet connection. Please check your connection and try again.")},className:"payment-form",children:[(0,c.jsx)("div",{className:"form-group",children:(0,c.jsx)(n.PaymentElement,{options:{layout:{type:"tabs",defaultCollapsed:!1}}})}),d&&(0,c.jsxs)("div",{className:"error-message",children:[(0,c.jsx)("i",{className:"fas fa-exclamation-circle"}),d,!m&&(0,c.jsx)("p",{className:"error-help",children:"Please check your internet connection and try again."}),h&&(0,c.jsxs)("p",{className:"error-details",children:["Details: ",h]})]}),(0,c.jsx)("button",{type:"submit",disabled:!r||o||!m,className:"btn-submit "+(m?"":"btn-disabled"),children:o?"Processing...":m?"Pay":"No Connection"})]})},m=()=>{var e,a,t,i,l,m;const[p,h]=(0,s.useState)([]),[g,v]=(0,s.useState)(!0),[f,y]=(0,s.useState)(null),[_,w]=(0,s.useState)(""),[x,j]=(0,s.useState)({id:null,program_id:"",motivation_letter:"",documents:[],document_ids:[],status:"draft",payment_status:"unpaid",errors:{program:"",documents:"",motivation_letter:""}}),[N,b]=(0,s.useState)(!1),[A,S]=(0,s.useState)(!1),[E,P]=(0,s.useState)([]),[z,D]=(0,s.useState)(null),[k,$]=(0,s.useState)([]),[R,J]=(0,s.useState)({program_id:"",motivation_letter:"",selectedDocuments:[],errors:{program:"",documents:"",motivation_letter:""}}),[C,I]=(0,s.useState)([]),[U,V]=(0,s.useState)(!1),[L,q]=(0,s.useState)(!1),[T,O]=(0,s.useState)(null),[H,W]=(0,s.useState)(!1),[F,M]=(0,s.useState)(!1),[Y,K]=(0,s.useState)([]);(0,s.useEffect)((()=>{console.log("selectedApplication actualizat:",x)}),[x]),(0,s.useEffect)((()=>{(async()=>{if(!z)try{const e=await X();D(e)}catch(f){console.error("Eroare la verificarea rolului:",f),y("Nu s-a putut verifica rolul utilizatorului")}})()}),[z]),(0,s.useEffect)((()=>{let e=!0;return(async()=>{if(!F&&!H)try{M(!0),v(!0),y(null);const[a,t,s]=await Promise.all([r.A.get(`${o.JR}/api/applications`,{headers:(0,o.z5)()}),r.A.get(`${o.JR}/api/programs`,{headers:(0,o.z5)()}),r.A.get(`${o.JR}/api/documents/user-documents`,{headers:(0,o.z5)()})]);if(!e)return;if(a.data.success){const e=a.data.data;console.log("Aplica\u021bii \xeenc\u0103rcate:",e),h(e)}if(t.data.success){const e=t.data.data;console.log("Programe \xeenc\u0103rcate:",e),P(e)}if(s.data.success){const e=s.data.data;console.log("Documente \xeenc\u0103rcate:",e),$(e)}const i=await B();i&&e&&(console.log("Programe salvate \xeenc\u0103rcate:",i),I(i)),e&&W(!0)}catch(f){console.error("Error loading data:",f),e&&(navigator.onLine?y("A ap\u0103rut o eroare la \xeenc\u0103rcarea datelor. V\u0103 rug\u0103m s\u0103 \xeencerca\u021bi din nou."):y("Nu exist\u0103 conexiune la internet. V\u0103 rug\u0103m s\u0103 verifica\u021bi conexiunea \u0219i s\u0103 \xeencerca\u021bi din nou."))}finally{e&&(v(!1),M(!1))}})(),()=>{e=!1}}),[]),(0,s.useEffect)((()=>{(async()=>{const e=new URLSearchParams(window.location.search).get("session_id");if(e&&!g)try{v(!0);const a=await r.A.get(`${o.JR}/api/payments/check-payment-status/${e}`,{headers:(0,o.z5)()});if(a.data.success&&"paid"===a.data.status){const e=JSON.parse(localStorage.getItem("pendingApplication"));if(e){if(!(await r.A.post(`${o.JR}/api/applications`,{...e,payment_status:"paid",status:"submitted"},{headers:(0,o.z5)()})).data.success)throw new Error("Nu s-a putut crea aplica\u021bia");{w("Plata a fost procesat\u0103 cu succes \u0219i aplica\u021bia a fost trimis\u0103!"),localStorage.removeItem("pendingApplication"),localStorage.removeItem("currentPaymentSession");const e=window.location.pathname;window.history.replaceState({},document.title,e);const a=await r.A.get(`${o.JR}/api/applications`,{headers:(0,o.z5)()});a.data.success&&h(a.data.data)}}}else{y(a.data.message||"Plata nu a fost procesat\u0103 cu succes. Aplica\u021bia r\u0103m\xe2ne \xeen draft.");const e=window.location.pathname;window.history.replaceState({},document.title,e)}}catch(f){var a,t;console.error("Payment check error:",f);const s=(null===(a=f.response)||void 0===a||null===(t=a.data)||void 0===t?void 0:t.message)||"A ap\u0103rut o eroare la verificarea pl\u0103\u021bii. Aplica\u021bia r\u0103m\xe2ne \xeen draft.";y(s);const r=window.location.pathname;window.history.replaceState({},document.title,r)}finally{v(!1)}})()}),[]);const Q=async()=>{try{v(!0);const[e,a]=await Promise.all([r.A.get(`${o.JR}/api/applications`,{headers:(0,o.z5)()}),r.A.get(`${o.JR}/api/documents/user-documents`,{headers:(0,o.z5)()})]);e.data.success&&h(e.data.data),a.data.success&&$(a.data.data)}catch(f){console.error("Error reloading data:",f),y("A ap\u0103rut o eroare la re\xeenc\u0103rcarea datelor")}finally{v(!1)}},X=async()=>{try{const e="admin"===(await r.A.get(`${o.JR}/api/user/role`,{headers:(0,o.z5)()})).data.role?"admin":"user";return D(e),e}catch(f){console.error("Error checking role:",f);const a="user";return D(a),a}},B=async()=>{try{const e=await r.A.get(`${o.JR}/api/saved-programs`,{headers:(0,o.z5)()});return e.data.success?e.data.data:[]}catch(f){return console.error("Error loading saved programs:",f),[]}},G=async e=>{if(e&&e.preventDefault(),(()=>{const e={program:"",documents:"",motivation_letter:""};let a=!0;return R.program_id||(e.program="Please select a program",a=!1),0===R.selectedDocuments.length&&(e.documents="Please select at least one document",a=!1),R.motivation_letter.trim()||(e.motivation_letter="Please write a motivation letter",a=!1),J((a=>({...a,errors:e}))),a})())try{v(!0),y(null);if(p.find((e=>e.program_id===R.program_id&&"paid"===e.payment_status&&["submitted","under_review","approved"].includes(e.status))))return y("Ave\u021bi deja o aplica\u021bie activ\u0103 pentru acest program."),void v(!1);const e=await r.A.post(`${o.JR}/api/payments/create-checkout-session`,{program_id:R.program_id,motivation_letter:R.motivation_letter,document_ids:Y,payment_status:"unpaid",status:"draft"},{headers:(0,o.z5)()});if(!e.data.success||!e.data.url)throw new Error(e.data.message||"Nu s-a putut crea sesiunea de checkout");localStorage.setItem("pendingApplication",JSON.stringify({program_id:R.program_id,motivation_letter:R.motivation_letter,document_ids:Y,payment_status:"unpaid",status:"draft"})),window.location.href=e.data.url}catch(f){var a,t;console.error("Error creating application:",f),y((null===(a=f.response)||void 0===a||null===(t=a.data)||void 0===t?void 0:t.message)||"A ap\u0103rut o eroare la crearea aplica\u021biei. V\u0103 rug\u0103m s\u0103 \xeencerca\u021bi din nou.")}finally{v(!1)}},Z=e=>{A?K((a=>{const t=a.includes(e)?a.filter((a=>a!==e)):[...a,e];return J((e=>({...e,selectedDocuments:t,errors:{...e.errors,documents:0===t.length?"V\u0103 rug\u0103m s\u0103 selecta\u021bi cel pu\u021bin un document":""}}))),t})):j((a=>{const t=Array.isArray(a.documents)?a.documents:[],s=t.some((a=>a.id===e)),r=k.find((a=>a.id===e));if(!r)return console.warn(`Documentul cu ID-ul ${e} nu a fost g\u0103sit \xeen userDocuments`),a;const i=s?t.filter((a=>a.id!==e)):[...t,r];return console.log("Documente actualizate:",i),{...a,documents:i,document_ids:i.map((e=>e.id)),errors:{...a.errors,documents:0===i.length?"V\u0103 rug\u0103m s\u0103 selecta\u021bi cel pu\u021bin un document":""}}}))},ee=async e=>{try{v(!0),y(null),console.log("\xcencepere vizualizare aplica\u021bie:",e);const a=(0,o.z5)();if(console.log("Headers pentru request:",a),!a.Authorization)throw new Error("Nu sunte\u021bi autentificat. V\u0103 rug\u0103m s\u0103 v\u0103 autentifica\u021bi din nou.");console.log("Se face request pentru detaliile aplica\u021biei:",e.id);const t=await r.A.get(`${o.JR}/api/applications/${e.id}`,{headers:a});if(console.log("R\u0103spuns server pentru detalii aplica\u021bie:",t.data),!t.data.success)throw new Error("Nu s-au putut ob\u021bine detaliile aplica\u021biei");const i=t.data.data;console.log("Date aplica\u021bie primite:",i);let n=[],c=[];if(i.document_ids)try{c="string"===typeof i.document_ids?JSON.parse(i.document_ids):Array.isArray(i.document_ids)?i.document_ids:[],console.log("ID-uri documente procesate:",c),n=c.map((e=>{const a=k.find((a=>a.id===e));return a||(console.warn(`Documentul cu ID-ul ${e} nu a fost g\u0103sit \xeen lista de documente utilizator`),null)})).filter((e=>null!==e)),console.log("Documente procesate:",n)}catch(s){console.error("Eroare la parsarea document_ids:",s),n=[],c=[]}const l=i.motivation_letter||"";l||console.warn("Scrisoarea de motiva\u021bie lipse\u0219te din datele aplica\u021biei");const d={id:i.id,program_id:i.program_id,motivation_letter:l,documents:n,document_ids:c,status:i.status||"draft",payment_status:i.payment_status||"unpaid",program:i.program,user_id:i.user_id,created_at:i.created_at||i.createdAt,updated_at:i.updated_at||i.updatedAt,errors:{program:"",documents:"",motivation_letter:""}};console.log("Aplica\u021bie actualizat\u0103 pentru editare:",d);const u=[];d.program_id||u.push("program_id"),d.motivation_letter||u.push("motivation_letter"),d.documents&&0!==d.documents.length||u.push("documents"),u.length>0&&console.warn("Lipsesc urm\u0103toarele date importante din aplica\u021bie:",u),j(d),b(!0);try{console.log("Se re\xeencarc\u0103 lista de documente...");const e=await r.A.get(`${o.JR}/api/documents/user-documents`,{headers:a});if(e.data.success&&(console.log("Documente re\xeenc\u0103rcate cu succes:",e.data.data),$(e.data.data),c.length>0)){const a=c.map((a=>{const t=e.data.data.find((e=>e.id===a));return t||(console.warn(`Documentul cu ID-ul ${a} nu a fost g\u0103sit \xeen noile date`),null)})).filter((e=>null!==e));console.log("Documente actualizate dup\u0103 re\xeenc\u0103rcare:",a),j((e=>({...e,documents:a})))}}catch(f){console.error("Eroare la re\xeenc\u0103rcarea documentelor:",f)}}catch(f){var a,t;console.error("Error loading application details:",f),y((null===(a=f.response)||void 0===a||null===(t=a.data)||void 0===t?void 0:t.message)||f.message||"A ap\u0103rut o eroare la \xeenc\u0103rcarea detaliilor aplica\u021biei")}finally{v(!1)}},ae=e=>{if(!e)return"-";try{const a=new Date(e);return isNaN(a.getTime())?"-":a.toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"})}catch(f){return console.error("Error formatting date:",f),"-"}},te=e=>{if(!e)return"Unknown";switch(e){case"draft":return"Draft";case"submitted":return"Submitted";case"under_review":return"Under Review";case"approved":return"Approved";case"rejected":return"Rejected";case"withdrawn":return"Withdrawn";default:return e.charAt(0).toUpperCase()+e.slice(1)}},se=e=>{if(!e)return"status-unknown";switch(e){case"draft":return"status-draft";case"submitted":return"status-submitted";case"under_review":return"status-under-review";case"approved":return"status-approved";case"rejected":return"status-rejected";case"withdrawn":return"status-withdrawn";default:return"status-unknown"}},re=e=>"admin"===z||("draft"===e.status||"paid"!==e.payment_status),ie=async e=>{const a=p.find((a=>a.id===e));if(re(a)){if(window.confirm("Are you sure you want to delete this application?"))try{v(!0),y(null);const a=await r.A.delete(`${o.JR}/api/applications/${e}`,{headers:(0,o.z5)()});if(!a.data.success)throw new Error(a.data.message||"Error deleting application");w("Application deleted successfully!"),b(!1),j({id:null,program_id:"",motivation_letter:"",documents:[],document_ids:[],status:"draft",payment_status:"unpaid",errors:{program:"",documents:"",motivation_letter:""}}),await Q()}catch(f){var t,s;console.error("Error deleting application:",f),y((null===(t=f.response)||void 0===t||null===(s=t.data)||void 0===s?void 0:s.message)||"An error occurred while deleting application")}finally{v(!1)}}else y("You cannot delete this application because it has already been submitted and paid.")},ne=e=>"admin"!==z&&["submitted","under_review"].includes(e.status),oe=async e=>{if(window.confirm("Are you sure you want to withdraw this application?"))try{v(!0),y(null);const a=await r.A.patch(`${o.JR}/api/applications/${e}/status`,{status:"withdrawn",notes:"Application withdrawn by user"},{headers:(0,o.z5)()});if(!a.data.success)throw new Error(a.data.message||"Error withdrawing application");w("Application withdrawn successfully!"),b(!1),j({id:null,program_id:"",motivation_letter:"",documents:[],document_ids:[],status:"draft",payment_status:"unpaid",errors:{program:"",documents:"",motivation_letter:""}}),await Q()}catch(f){var a,t;console.error("Error withdrawing application:",f),y((null===(a=f.response)||void 0===a||null===(t=a.data)||void 0===t?void 0:t.message)||"An error occurred while withdrawing application")}finally{v(!1)}},ce=async e=>{try{v(!0),y(null);const a=await r.A.get(`${o.JR}/api/applications/${e}`,{headers:(0,o.z5)()});if(!a.data.success)throw new Error("Nu s-a putut ob\u021bine detaliile aplica\u021biei");const t=a.data.data;if(console.log("Detaliile aplica\u021biei pentru plat\u0103:",t),!t.program_id)throw new Error("Programul nu a fost selectat. V\u0103 rug\u0103m s\u0103 selecta\u021bi un program.");let i=[];if(t.document_ids)try{i="string"===typeof t.document_ids?JSON.parse(t.document_ids):t.document_ids}catch(s){console.error("Eroare la parsarea document_ids:",s),i=t.document_ids}if(!i||0===i.length)throw new Error("Nu a\u021bi selectat niciun document. V\u0103 rug\u0103m s\u0103 selecta\u021bi cel pu\u021bin un document.");if(!t.motivation_letter)throw new Error("Scrisoarea de motiva\u021bie lipse\u0219te. V\u0103 rug\u0103m s\u0103 completa\u021bi scrisoarea de motiva\u021bie \xeenainte de a pl\u0103ti.");const n={applicationId:e,program_id:t.program_id,motivation_letter:t.motivation_letter,document_ids:i,payment_status:"unpaid",status:"draft",user_id:t.user_id,created_at:t.created_at,updated_at:t.updated_at};localStorage.setItem("pendingApplication",JSON.stringify(n));const c=await r.A.post(`${o.JR}/api/payments/create-checkout-session`,n,{headers:(0,o.z5)()});if(!c.data.success||!c.data.url)throw new Error("Nu s-a putut crea sesiunea de plat\u0103");console.log("Sesiune de plat\u0103 creat\u0103:",c.data.session_id),localStorage.setItem("currentPaymentSession",c.data.session_id),window.location.href=c.data.url}catch(f){var a,t;console.error("Eroare la ini\u021bializarea pl\u0103\u021bii:",f),y((null===(a=f.response)||void 0===a||null===(t=a.data)||void 0===t?void 0:t.message)||f.message||"A ap\u0103rut o eroare la procesarea pl\u0103\u021bii. V\u0103 rug\u0103m s\u0103 \xeencerca\u021bi din nou.")}finally{v(!1)}};return(0,c.jsxs)("div",{className:"application-tab",children:[(0,c.jsxs)("div",{className:"application-section",children:[(0,c.jsx)("h2",{children:"admin"===z?"All Applications":"My Applications"}),"admin"!==z&&(0,c.jsxs)("button",{className:"btn1",onClick:()=>S(!0),disabled:g,children:[(0,c.jsx)("i",{className:"fas fa-plus"})," Create New Application"]})]}),_&&(0,c.jsx)("div",{className:"alert-success",children:_}),f&&(0,c.jsx)("div",{className:"alert-error",children:f}),(0,c.jsxs)("div",{className:"application-stats",children:[(0,c.jsxs)("div",{className:"application-stat",children:["Drafts",(0,c.jsx)("span",{className:"stat-value status-draft",children:p.filter((e=>"draft"===e.status)).length})]}),(0,c.jsxs)("div",{className:"application-stat",children:["Submitted",(0,c.jsx)("span",{className:"stat-value status-submitted",children:p.filter((e=>"submitted"===e.status)).length})]}),(0,c.jsxs)("div",{className:"application-stat",children:["Under Review",(0,c.jsx)("span",{className:"stat-value status-under-review",children:p.filter((e=>"under_review"===e.status)).length})]}),(0,c.jsxs)("div",{className:"application-stat",children:["Approved",(0,c.jsx)("span",{className:"stat-value status-approved",children:p.filter((e=>"approved"===e.status)).length})]}),(0,c.jsxs)("div",{className:"application-stat",children:["Rejected",(0,c.jsx)("span",{className:"stat-value status-rejected",children:p.filter((e=>"rejected"===e.status)).length})]}),(0,c.jsxs)("div",{className:"application-stat",children:["Withdrawn",(0,c.jsx)("span",{className:"stat-value status-withdrawn",children:p.filter((e=>"withdrawn"===e.status)).length})]})]}),g?(0,c.jsxs)("div",{className:"loading-container",children:[(0,c.jsx)("div",{className:"loading-spinner"}),(0,c.jsx)("p",{children:"Loading applications..."})]}):0===p.length?(0,c.jsx)("div",{className:"no-applications",children:(0,c.jsx)("p",{children:"No applications found."})}):(0,c.jsx)("div",{className:"applications-table-container",children:(0,c.jsxs)("table",{className:"profile-table",children:[(0,c.jsx)("thead",{children:(0,c.jsxs)("tr",{children:["admin"===z&&(0,c.jsx)("th",{children:"User"}),(0,c.jsx)("th",{children:"Program"}),(0,c.jsx)("th",{children:"University"}),(0,c.jsx)("th",{children:"Application Date"}),(0,c.jsx)("th",{children:"Status"}),(0,c.jsx)("th",{children:"Payment"}),(0,c.jsx)("th",{children:"Actions"})]})}),(0,c.jsx)("tbody",{children:p.map((e=>{var a,t,s;return(0,c.jsxs)("tr",{children:["admin"===z&&(0,c.jsx)("td",{children:e.user_name||`User ID: ${e.user_id}`}),(0,c.jsx)("td",{children:(null===(a=e.program)||void 0===a?void 0:a.name)||"N/A"}),(0,c.jsx)("td",{children:(null===(t=e.program)||void 0===t||null===(s=t.university)||void 0===s?void 0:s.name)||"N/A"}),(0,c.jsx)("td",{children:ae(e.created_at||e.updated_at||e.submitted_at)}),(0,c.jsx)("td",{children:(0,c.jsx)("span",{className:`status-badge ${se(e.status)}`,children:te(e.status)})}),(0,c.jsx)("td",{children:(0,c.jsx)("span",{className:"payment-status "+("paid"===e.payment_status?"paid":"unpaid"),children:"paid"===e.payment_status?"Paid":"Unpaid"})}),(0,c.jsx)("td",{children:(0,c.jsxs)("div",{className:"application-actions",children:["draft"===e.status&&(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)("button",{className:"btn btn-grey",onClick:()=>ee(e),children:"Edit"}),re(e)&&(0,c.jsx)("button",{className:"btn btn-delete",onClick:()=>ie(e.id),children:"Delete"})]}),"draft"===e.status&&"paid"!==e.payment_status&&(0,c.jsx)("button",{className:"btn btn-success",onClick:()=>ce(e.id),children:"Pay Application Fee"}),["submitted","under_review"].includes(e.status)&&ne(e)&&(0,c.jsx)("button",{className:"btn1",onClick:()=>oe(e.id),children:"Withdraw Application"})]})})]},e.id)}))})]})}),A&&(0,c.jsx)("div",{className:"modal",children:(0,c.jsxs)("div",{className:"modal-content",children:[(0,c.jsx)("h2",{children:"Create New Application"}),U&&T?(0,c.jsx)(n.Elements,{stripe:d,options:{clientSecret:T},children:(0,c.jsx)(u,{onPaymentSuccess:async e=>{try{const a=await r.A.post(`${o.JR}/api/payments/verify`,{paymentMethodId:e,applicationId:R.id},{headers:(0,o.z5)()});if(!a.data.success)throw new Error(a.data.message||"Error verifying payment");q(!0),V(!1),w("Payment processed successfully!"),await G()}catch(f){console.error("Error verifying payment:",f),y("An error occurred while verifying payment. Please contact support.")}},onPaymentError:e=>{y(e)}})}):(0,c.jsxs)("form",{onSubmit:G,className:"application-form",children:[(0,c.jsxs)("div",{className:"form-group",children:[(0,c.jsxs)("label",{children:["Program: ",(0,c.jsx)("span",{className:"required",children:"*"})]}),(0,c.jsxs)("select",{value:R.program_id,onChange:e=>J({...R,program_id:e.target.value,errors:{...R.errors,program:""}}),className:"form-select "+(R.errors.program?"error":""),children:[(0,c.jsx)("option",{value:"",children:"Select a program"}),C.length>0?C.map((e=>{var a;return(0,c.jsxs)("option",{value:e.id,children:[e.name," - ",null===(a=e.university)||void 0===a?void 0:a.name]},e.id)})):(0,c.jsx)("option",{value:"",disabled:!0,children:"No saved programs"})]}),R.errors.program&&(0,c.jsx)("span",{className:"error-message",children:R.errors.program}),0===C.length&&(0,c.jsx)("p",{className:"info-message",children:"To create an application, you need to save a program from the programs list first."})]}),(0,c.jsxs)("div",{className:"form-group",children:[(0,c.jsxs)("label",{children:["Motivation Letter: ",(0,c.jsx)("span",{className:"required",children:"*"})]}),(0,c.jsx)("textarea",{value:R.motivation_letter,onChange:e=>J({...R,motivation_letter:e.target.value,errors:{...R.errors,motivation_letter:""}}),className:"form-textarea "+(R.errors.motivation_letter?"error":""),rows:"6",placeholder:"Write your motivation letter..."}),R.errors.motivation_letter&&(0,c.jsx)("span",{className:"error-message",children:R.errors.motivation_letter})]}),(0,c.jsxs)("div",{className:"form-group",children:[(0,c.jsxs)("label",{children:["Required Documents: ",(0,c.jsx)("span",{className:"required",children:"*"})]}),(0,c.jsxs)("div",{className:"documents-selection",children:[k&&0!==k.length?(0,c.jsx)("div",{className:"documents-list",children:k.map(((e,a)=>(0,c.jsxs)("div",{className:"document-item",children:[(0,c.jsxs)("label",{className:"document-checkbox",children:[(0,c.jsx)("input",{type:"checkbox",checked:R.selectedDocuments.includes(e.id),onChange:()=>Z(e.id)}),(0,c.jsx)("span",{className:"document-name",children:e.name||e.document_type})]}),e.url&&(0,c.jsxs)("a",{href:e.url,target:"_blank",rel:"noopener noreferrer",className:"document-preview",children:[(0,c.jsx)("i",{className:"fas fa-eye"})," View"]})]},`doc-${e.id}-${a}`)))}):(0,c.jsx)("p",{className:"no-documents",children:"You don't have any uploaded documents. Please upload your documents in the profile section."}),R.errors.documents&&(0,c.jsx)("span",{className:"error-message",children:R.errors.documents})]})]}),(0,c.jsxs)("div",{className:"form-info",children:[(0,c.jsxs)("p",{children:[(0,c.jsx)("span",{className:"required",children:"*"})," Required fields"]}),(0,c.jsxs)("div",{className:"payment-info",children:[(0,c.jsx)("i",{className:"fas fa-info-circle"}),(0,c.jsx)("p",{children:"To submit your application, you need to pay a one-time application fee of 30 EUR. Payment will be processed after completing the form."})]})]}),(0,c.jsxs)("div",{className:"button-group",children:[(0,c.jsx)("button",{type:"submit",className:"btn btn-primary",children:"Continue to Payment"}),(0,c.jsx)("button",{type:"button",className:"btn btn-grey-2",onClick:()=>{S(!1),J({program_id:"",motivation_letter:"",selectedDocuments:[],errors:{program:"",documents:"",motivation_letter:""}}),K([]),S(!1)},children:"Cancel"})]})]})]})}),N&&x&&(0,c.jsx)("div",{className:"modal",children:(0,c.jsxs)("div",{className:"modal-content",children:[(0,c.jsx)("h2",{children:"Detalii Aplica\u021bie"}),(0,c.jsxs)("div",{className:"application-details",children:["admin"===z&&(0,c.jsxs)("p",{children:[(0,c.jsx)("strong",{children:"Utilizator:"})," ",x.user_name||`ID: ${x.user_id}`]}),(0,c.jsxs)("p",{children:[(0,c.jsx)("strong",{children:"Program:"})," ",(null===(e=x.program)||void 0===e?void 0:e.name)||"N/A"]}),(0,c.jsxs)("p",{children:[(0,c.jsx)("strong",{children:"Universitate:"})," ",(null===(a=x.program)||void 0===a||null===(t=a.university)||void 0===t?void 0:t.name)||"N/A"]}),(0,c.jsxs)("p",{children:[(0,c.jsx)("strong",{children:"Data aplic\u0103rii:"})," ",ae(x.created_at)]}),(0,c.jsxs)("p",{children:[(0,c.jsx)("strong",{children:"Status:"})," ",te(x.status)]}),(0,c.jsxs)("p",{children:[(0,c.jsx)("strong",{children:"Status plat\u0103:"})," ","paid"===x.payment_status?"Pl\u0103tit":"Nepl\u0103tit"]}),(0,c.jsxs)("div",{className:"form-group",children:[(0,c.jsx)("label",{children:(0,c.jsx)("strong",{children:"Scrisoare de motiva\u021bie:"})}),(0,c.jsx)("textarea",{value:x.motivation_letter||"",onChange:e=>j((a=>({...a,motivation_letter:e.target.value,errors:{...a.errors,motivation_letter:""}}))),className:"form-textarea "+(null!==(i=x.errors)&&void 0!==i&&i.motivation_letter?"error":""),rows:"6",placeholder:"Scrie\u021bi scrisoarea de motiva\u021bie...",disabled:"draft"!==x.status}),(null===(l=x.errors)||void 0===l?void 0:l.motivation_letter)&&(0,c.jsx)("span",{className:"error-message",children:x.errors.motivation_letter})]}),(0,c.jsxs)("div",{className:"form-group",children:[(0,c.jsx)("label",{children:(0,c.jsx)("strong",{children:"Documente selectate:"})}),(0,c.jsxs)("div",{className:"documents-selection",children:[k&&0!==k.length?(0,c.jsx)("div",{className:"documents-list",children:k.map((e=>{const a=x.documents&&x.documents.some((a=>a.id===e.id));return(0,c.jsxs)("div",{className:"document-item",children:[(0,c.jsxs)("label",{className:"document-checkbox",children:[(0,c.jsx)("input",{type:"checkbox",checked:a,onChange:()=>Z(e.id),disabled:"draft"!==x.status}),(0,c.jsx)("span",{className:"document-name",children:e.name||e.document_type})]}),e.url&&(0,c.jsxs)("a",{href:e.url,target:"_blank",rel:"noopener noreferrer",className:"document-preview",children:[(0,c.jsx)("i",{className:"fas fa-eye"})," Vizualizare"]})]},e.id)}))}):(0,c.jsx)("p",{className:"no-documents",children:"Nu ave\u021bi niciun document \xeenc\u0103rcat. V\u0103 rug\u0103m s\u0103 \xeenc\u0103rca\u021bi documentele \xeen sec\u021biunea de profil."}),(null===(m=x.errors)||void 0===m?void 0:m.documents)&&(0,c.jsx)("span",{className:"error-message",children:x.errors.documents})]})]}),(0,c.jsxs)("div",{className:"action-buttons",children:["draft"===x.status&&(0,c.jsx)("button",{className:"btn btn-primary",onClick:async()=>{try{var e;v(!0),y(null),console.log("\xcencepere actualizare aplica\u021bie:",x);const a={motivation_letter:"",documents:""};let t=!1;const s=(null===(e=x.motivation_letter)||void 0===e?void 0:e.trim())||"";s||(a.motivation_letter="Scrisoarea de motiva\u021bie este obligatorie",t=!0);const i=Array.isArray(x.documents)?x.documents:[];if(0===i.length&&(a.documents="V\u0103 rug\u0103m s\u0103 selecta\u021bi cel pu\u021bin un document",t=!0),t)return console.log("Erori de validare g\u0103site:",a),j((e=>({...e,errors:a}))),void v(!1);const n={motivation_letter:s,document_ids:i.map((e=>e.id)),status:x.status||"draft",payment_status:x.payment_status||"unpaid",program_id:x.program_id,user_id:x.user_id};if(console.log("Date pentru actualizare:",n),!n.motivation_letter||!n.document_ids.length||!n.program_id)return console.error("Date incomplete pentru actualizare:",n),y("Toate c\xe2mpurile sunt obligatorii. V\u0103 rug\u0103m s\u0103 completa\u021bi toate c\xe2mpurile."),void v(!1);const c=await r.A.patch(`${o.JR}/api/applications/${x.id}`,n,{headers:{...(0,o.z5)(),"Content-Type":"application/json"}});if(console.log("R\u0103spuns server la actualizare:",c.data),!c.data.success)throw new Error(c.data.message||"Eroare la actualizarea aplica\u021biei");const l=await r.A.get(`${o.JR}/api/applications/${x.id}`,{headers:(0,o.z5)()});if(!l.data.success)throw new Error("Nu s-au putut verifica detaliile aplica\u021biei actualizate");const d=l.data.data;console.log("Aplica\u021bie verificat\u0103 dup\u0103 actualizare:",d),console.log("Se re\xeencarc\u0103 lista de aplica\u021bii...");const u=await r.A.get(`${o.JR}/api/applications`,{headers:(0,o.z5)()});if(!u.data.success)throw new Error("Nu s-au putut \xeenc\u0103rca aplica\u021biile actualizate");console.log("Lista de aplica\u021bii re\xeenc\u0103rcat\u0103 cu succes:",u.data.data),h(u.data.data),w("Aplica\u021bia a fost actualizat\u0103 cu succes!"),b(!1),j({id:null,program_id:"",motivation_letter:"",documents:[],document_ids:[],status:"draft",payment_status:"unpaid",errors:{program:"",documents:"",motivation_letter:""}})}catch(f){var a,t;console.error("Error updating application:",f),y((null===(a=f.response)||void 0===a||null===(t=a.data)||void 0===t?void 0:t.message)||f.message||"A ap\u0103rut o eroare la actualizarea aplica\u021biei")}finally{v(!1)}},disabled:g,children:g?"Se salveaz\u0103...":"Salveaz\u0103 modific\u0103rile"}),re(x)&&(0,c.jsxs)("button",{className:"btn btn-delete",onClick:()=>ie(x.id),disabled:g,children:[(0,c.jsx)("i",{className:"fas fa-trash"})," \u0218terge aplica\u021bia"]}),ne(x)&&(0,c.jsxs)("button",{className:"btn1",onClick:()=>oe(x.id),disabled:g,children:[(0,c.jsx)("i",{className:"fas fa-undo"})," Retrage aplica\u021bia"]}),(0,c.jsx)("button",{className:"btn btn-grey-2",onClick:()=>{b(!1),j({id:null,program_id:"",motivation_letter:"",documents:[],document_ids:[],status:"draft",payment_status:"unpaid",errors:{program:"",documents:"",motivation_letter:""}})},children:"\xcenchide"})]})]})]})})]})}}}]);
//# sourceMappingURL=779.6e3a99db.chunk.js.map